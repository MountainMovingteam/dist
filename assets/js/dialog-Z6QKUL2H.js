import{s as he}from"./pinia-KM1LF1CQ.js";import{l as ve,r as Ie,n as Ve}from"./index-Db6VnN3C.js";import{u as ke,a as Ce,s as xe}from"./index-D5rcBUyM.js";import{S as Me}from"./@element-plus-e7foqBra.js";import{d as De}from"./exportXLSX-QeXp5zvZ.js";import{g as Ee,E as m}from"./element-plus-CXqQ8W6I.js";import{d as J,b as q,Z as R,i as we,ah as p,o as c,c as E,U as o,O as a,a as f,S as g,F,a7 as T,M as h,u as Se,R as w,T as A,J as Ue}from"./@vue-HrMasQv8.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-CNO1fUVn.js";import"./vue-i18n-BvBBS3QZ.js";import"./@intlify-COHHyPI8.js";import"./vue-CE7TxhWI.js";import"./js-cookie-Cz0CWeBA.js";import"./nprogress-Bx-CsPDi.js";import"./axios-Cm0UX6qg.js";import"./qs-Bc-_vL76.js";import"./side-channel-nON-R0av.js";import"./get-intrinsic-B1Ut8WxJ.js";import"./es-errors-DzOT6E3C.js";import"./has-symbols-eVqrYdw7.js";import"./has-proto-JnoBQRdH.js";import"./function-bind-B8G-TZ45.js";import"./hasown-B9bXSDSU.js";import"./call-bind-Aj7T_c8u.js";import"./set-function-length-Ct5B6P4y.js";import"./define-data-property-CUxyvwXF.js";import"./es-define-property-28jGrh5V.js";import"./gopd-O61WwtTx.js";import"./has-property-descriptors-Cvfij9iw.js";import"./object-inspect-CZY0DhK8.js";import"./mitt-DJ65BbbF.js";import"./vue-grid-layout-CDkJeOvw.js";import"./lodash-es-WEemOz_S.js";import"./@vueuse-D31sEaKM.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-CphgU6An.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-FEUMNzka.js";import"./xlsx-BxNF3BLs.js";const Fe={class:"system-menu-dialog-container"},We=f("div",{class:"el-upload__text"}," 点击此处上传文件批量导入团队信息 ",-1),Be={class:"el-upload__tip"},Oe={style:{"margin-left":"5px","font-weight":"bold"}},Ne=f("div",{style:{"margin-top":"20px"}},null,-1),qe=f("div",{style:{"margin-top":"20px"}},null,-1),Te=f("div",{style:{"margin-top":"20px"}},null,-1),Ae=f("div",{style:{"margin-top":"20px"}},null,-1),Le=f("div",{style:{"margin-top":"20px"}},null,-1),je=f("div",{style:{"margin-top":"20px"}},null,-1),ze=f("div",{style:{"margin-top":"20px"}},null,-1),$e={class:"dialog-footer"},Re=J({name:"systemMenuDialog"}),Wt=J({...Re,props:{campus:{type:String,default:""},bookingWay:{type:String,default:""},row:{type:Number,default:0},column:{type:Number,default:0},groupColors:{type:Array,default:()=>[]},singleColors:{type:Array,default:()=>[]},capacity:{type:Array,default:()=>[]}},emits:["refresh","updateCampus","updateBookingWay"],setup(G,{expose:H,emit:K}){const v=G,S=K,P=q(),Z=ve(),{routesList:Q}=he(Z),U=/^\d+/,e=R({data:{campus:"",bookingWay:"",row:0,column:0},selectedDay:"",days:ee(),selectedEvent:"",events:["第1场 8:00-9:30","第2场 10:00-11:30","第3场 14:00-15:30","第4场 16:00-17:30"],accessibleEvents:[],groupColors:[],singleColors:[],capacity:[],selectedCapacity:[],teamMembers:[{name:"",studentId:"",phone:"",college:""}],personalInfo:{name:"",studentId:"",phone:"",college:""},resolvedList:[{name:"",id:""}],ruleForm:{menuSuperior:[],menuType:"menu",name:"",component:"",componentAlias:"",isLink:!1,menuSort:0,path:"",redirect:"",meta:{title:"",icon:"",isHide:!1,isKeepAlive:!0,isAffix:!1,isLink:"",isIframe:!1,roles:""},btnPower:""},menuData:[],dialog:{isShowDialog:!1,type:"",title:"",submitTxt:""}}),b=R({teamMembers:(()=>{const t=[];t.push({name:[{required:!0,message:"请输入负责人的姓名",trigger:"blur"}],studentId:[{required:!0,message:"请输入负责人的学号",trigger:"blur"}],phone:[{required:!0,message:"请输入负责人的电话号码",trigger:"blur"}],college:[{required:!0,message:"请输入系号+学院名称，例如“6系 计算机学院”",trigger:"blur"}]});for(let l=1;l<20;l++)t.push({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],studentId:[{required:!0,message:"请输入学号",trigger:"blur"}],phone:[],college:[]});return t})(),personalInfo:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],studentId:[{required:!0,message:"请输入学号",trigger:"blur"}],phone:[{required:!0,message:"请输入电话号码",trigger:"blur"}],college:[{required:!0,message:"请输入系号+学院名称，例如“6系 计算机学院”",trigger:"blur"}]}}),L=t=>t===0,C=()=>{e.teamMembers.splice(e.selectedCapacity[e.events.indexOf(e.selectedEvent)])},X=()=>{e.teamMembers.push({name:"",studentId:"",phone:"",college:""})},Y=t=>{e.teamMembers.splice(t,1)},j=(t,l)=>e.accessibleEvents.includes(t)?l+`（剩余可预约人数${e.selectedCapacity[t]}人）`:l+"（该时间段不可预约）";function ee(){const t=[],l=new Date,n=["周日","周一","周二","周三","周四","周五","周六"];for(let s=0;s<7;s++){const r=new Date(l);r.setDate(l.getDate()+s);const i=r.getMonth()+1,I=r.getDate(),M=r.getDay(),k=`${i}月${I}日 ${n[M]}`;t.push(k)}return t}const te=()=>{De([{学号:"",姓名:""}],"团队预约导入模板.xlsx")},z=t=>{const l=[];return t.map(n=>{var s;n.title=Ve.global.t((s=n.meta)==null?void 0:s.title),l.push({...n}),n.children&&z(n.children)}),l},le=(t,l)=>{e.data.campus=v.campus,e.data.bookingWay=v.bookingWay,e.data.row=v.row,e.selectedEvent=e.events[e.data.row],e.data.column=v.column,e.selectedDay=e.days[e.data.column-1],e.groupColors=v.groupColors,e.singleColors=v.singleColors,e.capacity=v.capacity;let n=4*(e.data.column-1)+1;e.data.campus==="shahe"&&(n+=28),e.selectedCapacity=[];for(let s=n;s<n+4;s++)e.selectedCapacity.push(e.capacity[s]);e.accessibleEvents=[];for(let s=n;s<n+4;s++)e.data.bookingWay==="group"?e.groupColors[s]=="#99FF99"&&e.accessibleEvents.push(s-n):e.singleColors[s]=="#99FF99"&&e.accessibleEvents.push(s-n);t==="edit"?(l.menuType="menu",l.menuSort=Math.floor(Math.random()*100),e.ruleForm=JSON.parse(JSON.stringify(l)),e.dialog.title="预约信息",e.dialog.submitTxt="修 改"):(e.dialog.title="预约信息",e.dialog.submitTxt="新 增"),e.dialog.type=t,e.dialog.isShowDialog=!0},x=()=>{e.dialog.isShowDialog=!1},oe=()=>{x()},W=(t,l,n)=>{let s=4*(e.data.column-1)+1;l!=null&&(s=4*e.days.indexOf(l)+1),t!=null&&t=="shahe"&&(s+=28),e.selectedCapacity=[];for(let r=s;r<s+4;r++)e.selectedCapacity.push(e.capacity[r]);e.accessibleEvents=[];for(let r=s;r<s+4;r++)n=="group"?e.groupColors[r]=="#99FF99"&&e.accessibleEvents.push(r-s):e.singleColors[r]=="#99FF99"&&e.accessibleEvents.push(r-s)},ae=t=>{W(t,e.selectedDay,e.data.bookingWay),S("updateCampus",t)},se=t=>{C(),W(e.data.campus,t,e.data.bookingWay)},ne=t=>{C(),W(e.data.campus,e.selectedDay,t),S("updateBookingWay",t)},re=()=>{C()},de=()=>e.selectedDay.trim()===""||e.selectedEvent.trim()===""?(m({type:"error",message:"请选择具体时间！"}),!1):!0,ue=()=>{if(e.accessibleEvents.indexOf(e.events.indexOf(e.selectedEvent))==-1)return m({type:"error",message:"请选择有效时间段！"}),!1;if(e.teamMembers.length<10)return m({type:"error",message:"团队预约至少超过10人！"}),!1;const t=e.teamMembers[0],l=e.teamMembers.slice(1);if(t.name.trim()===""||t.studentId.trim()===""||t.phone.trim()===""||t.college.trim()==="")return m({type:"error",message:"请完整填写负责人的个人信息！"}),!1;if(!U.test(t.college.trim()))return m({type:"error",message:"请保证在开头输入系号！"}),!1;for(const n of l)if(n.name.trim()===""||n.studentId.trim()==="")return m({type:"error",message:"请完整填写其他成员个人信息！"}),!1;return!0},ie=()=>{const[t,...l]=e.teamMembers,n={name:t.name,id:t.studentId,phone:t.phone},s=l.map(({name:k,studentId:O})=>({id:O,name:k})),r=e.teamMembers[0].college.trim().match(U);let i=parseInt(r==null?void 0:r[0],10),I=(e.data.column-1)*4+e.data.row+1;e.data.campus=="shahe"&&(I+=28),Ce(n,s,i,I).then(()=>{m({type:"success",message:"预约成功"}),x()}).catch(()=>{m({type:"error",message:"预约失败，请重试!"}),x()})},me=()=>{if(e.accessibleEvents.indexOf(e.events.indexOf(e.selectedEvent))==-1)return m({type:"error",message:"请选择有效时间段！"}),!1;const t=e.personalInfo;return t.name.trim()===""||t.studentId.trim()===""||t.phone.trim()===""||t.college.trim()===""?(m({type:"error",message:"请完整填写个人信息！"}),!1):U.test(t.college.trim())?!0:(m({type:"error",message:"请保证在开头输入系号！"}),!1)},pe=()=>{let t=(e.data.column-1)*4+e.data.row+1;e.data.campus=="shahe"&&(t+=28);const l=e.personalInfo.college.trim().match(U);let n=parseInt(l==null?void 0:l[0],10);xe(t,e.personalInfo.name,e.personalInfo.studentId,e.personalInfo.phone,n).then(()=>{m({type:"success",message:"预约成功"}),x()}).catch(()=>{m({type:"error",message:"预约失败，请重试!"}),x()})},ce=()=>{if(de())if(e.data.bookingWay==="group")if(ue())ie(),C(),S("refresh");else return;else if(me())pe(),C(),S("refresh");else return},B=q(),V=q(),fe=t=>{var n;B.value.clearFiles(),V.value=[];const l=t[0];l.uid=Ee(),(n=V.value)==null||n.push(l),B.value.handleStart(l)},ge=t=>t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel"?!0:(m.error("请上传excel文件"),!1),be=()=>{if(V.value!=null){const t=new FormData;t.append("file",V.value[0].raw),ke(t).then(n=>{if(e.resolvedList=Object.values(n.data).find(Array.isArray),e.resolvedList.length>19)return m({type:"error",message:"团队预约不得超过20人，文件中无需填写负责人的信息！"}),!1;e.teamMembers.splice(1),e.resolvedList.forEach(s=>{let r=s.name==="None"?"":s.name,i=s.id==="None"?"":s.id;e.teamMembers.push({name:r,studentId:i,phone:"",college:""})}),m({type:"success",message:"解析成功!"})}).catch(()=>{m({type:"error",message:"解析文件失败，请重试!"})})}};return we(()=>{e.menuData=z(Q.value),Ie().then(l=>{const n=l.data.student_info;e.personalInfo.name=n.name,e.personalInfo.studentId=n.id;const s=e.teamMembers[0];s.name=n.name,s.studentId=n.id})}),H({openDialog:le}),(t,l)=>{const n=p("el-radio"),s=p("el-radio-group"),r=p("el-form-item"),i=p("el-col"),I=p("el-option"),M=p("el-select"),k=p("el-icon"),O=p("el-upload"),D=p("el-button"),$=p("el-row"),_=p("el-input"),N=p("el-form"),_e=p("ele-Check"),ye=p("el-dialog");return c(),E("div",Fe,[o(ye,{title:e.dialog.title,modelValue:e.dialog.isShowDialog,"onUpdate:modelValue":l[10]||(l[10]=d=>e.dialog.isShowDialog=d),width:"769px"},{footer:a(()=>[f("span",$e,[o(D,{onClick:oe,size:"default"},{default:a(()=>[g("取 消")]),_:1}),o(D,{type:"success",onClick:ce,size:"default"},{default:a(()=>[o(k,null,{default:a(()=>[o(_e)]),_:1}),g(" 确定预约 ")]),_:1})])]),default:a(()=>[o(N,{ref_key:"menuDialogFormRef",ref:P,model:e.ruleForm,size:"default","label-width":"80px"},{default:a(()=>[o($,{gutter:35},{default:a(()=>[o(i,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(r,{label:"校区选择"},{default:a(()=>[o(s,{modelValue:e.data.campus,"onUpdate:modelValue":l[0]||(l[0]=d=>e.data.campus=d),onChange:ae},{default:a(()=>[o(n,{label:"xueyuan"},{default:a(()=>[g("学院路校区")]),_:1}),o(n,{label:"shahe"},{default:a(()=>[g("沙河校区")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(i,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(r,{label:"预约方式"},{default:a(()=>[o(s,{modelValue:e.data.bookingWay,"onUpdate:modelValue":l[1]||(l[1]=d=>e.data.bookingWay=d),onChange:ne},{default:a(()=>[o(n,{label:"group"},{default:a(()=>[g("团队预约    ")]),_:1}),o(n,{label:"single"},{default:a(()=>[g("个人预约")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(i,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(r,{label:"预约日期"},{default:a(()=>[o(M,{modelValue:e.selectedDay,"onUpdate:modelValue":l[2]||(l[2]=d=>e.selectedDay=d),placeholder:"请选择预约日期",class:"w100",onChange:se},{default:a(()=>[(c(!0),E(F,null,T(e.days,(d,u)=>(c(),h(I,{key:u,label:d,value:d},{default:a(()=>[g(A(d),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(i,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(r,{label:"预约场次"},{default:a(()=>[o(M,{modelValue:e.selectedEvent,"onUpdate:modelValue":l[3]||(l[3]=d=>e.selectedEvent=d),placeholder:"请选择预约场次",class:"w100",onChange:re},{default:a(()=>[(c(!0),E(F,null,T(e.events,(d,u)=>(c(),h(I,{key:u,label:j(u,d),value:d,disabled:!e.accessibleEvents.includes(u)},{default:a(()=>[f("span",{style:Ue({color:e.accessibleEvents.includes(u)?"inherit":"gray"})},A(j(u,d)),5)]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e.data.bookingWay==="group"?(c(),h(i,{key:0,xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(N,{model:e,rules:b,ref:"form"},{default:a(()=>[o(r,{label:"团队信息",span:24}),o(O,{class:"upload-demo",drag:"",limit:1,"before-upload":ge,"file-list":V.value,"onUpdate:fileList":l[5]||(l[5]=d=>V.value=d),ref_key:"uploadRef",ref:B,action:"#","auto-upload":!1,style:{"margin-bottom":"30px"},"on-exceed":fe},{tip:a(()=>[f("div",Be,[g(" 请上传excel文件，格式要求为两列（学号，姓名），无需提供负责人的信息， "),f("a",{href:"javascript:void(0);",onClick:l[4]||(l[4]=d=>te())},"点击这里下载模板文件")])]),default:a(()=>[o(k,{class:"el-icon--upload"},{default:a(()=>[o(Se(Me))]),_:1}),We]),_:1},8,["file-list"]),o(D,{type:"success",style:{"margin-bottom":"10px"},class:"success-button",onClick:be},{default:a(()=>[g("提交文件")]),_:1}),(c(!0),E(F,null,T(e.teamMembers,(d,u)=>(c(),E(F,null,[o($,{class:"mb10",type:"flex",justify:"space-between"},{default:a(()=>[f("span",Oe,"成员"+A(u===0?u+1+"（负责人）":u+1),1),u!=0?(c(),h(r,{key:0,style:{"margin-right":"18px"}},{default:a(()=>[o(i,null,{default:a(()=>[o(D,{onClick:y=>Y(u),type:"danger",size:"small"},{default:a(()=>[g("删除该成员")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):w("",!0)]),_:2},1024),o(r,{span:24,class:"mb20",label:"姓名",prop:"teamMembers["+u+"].name",rules:b.teamMembers[u].name},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:d.name,"onUpdate:modelValue":y=>d.name=y,placeholder:"姓名",disabled:L(u)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),_:2},1032,["prop","rules"]),Ne,o(r,{span:24,class:"mb20",label:"学号",prop:"teamMembers["+u+"].studentId",rules:b.teamMembers[u].studentId},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:d.studentId,"onUpdate:modelValue":y=>d.studentId=y,placeholder:"学号",disabled:L(u)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),_:2},1032,["prop","rules"]),qe,u===0?(c(),h(r,{key:0,span:24,class:"mb20",label:"电话",prop:"teamMembers["+u+"].phone",rules:b.teamMembers[u].phone},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:d.phone,"onUpdate:modelValue":y=>d.phone=y,placeholder:"电话号码",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["prop","rules"])):w("",!0),Te,u===0?(c(),h(r,{key:1,span:24,class:"mb20",label:"学院",prop:"teamMembers["+u+"].college",rules:b.teamMembers[u].college},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:d.college,"onUpdate:modelValue":y=>d.college=y,placeholder:"系号+学院名称，例如“6系 计算机学院”",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["prop","rules"])):w("",!0),Ae,u===e.teamMembers.length-1&&e.teamMembers.length<e.selectedCapacity[e.events.indexOf(e.selectedEvent)]?(c(),h(D,{key:2,style:{"margin-top":"20px"},onClick:X},{default:a(()=>[g("增加成员")]),_:1})):w("",!0)],64))),256))]),_:1},8,["model","rules"])]),_:1})):e.data.bookingWay==="single"?(c(),h(i,{key:1,xs:24,sm:24,md:24,lg:24,xl:24,class:"mb10"},{default:a(()=>[o(N,{model:e,rules:b,ref:"form"},{default:a(()=>[o(r,{label:"个人信息"}),o(r,{span:24,class:"mb20",label:"姓名",prop:"personalInfo.name",rules:b.personalInfo.name},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:e.personalInfo.name,"onUpdate:modelValue":l[6]||(l[6]=d=>e.personalInfo.name=d),placeholder:"姓名",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),Le,o(r,{span:24,class:"mb20",label:"学号",prop:"personalInfo.studentId",rules:b.personalInfo.studentId},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:e.personalInfo.studentId,"onUpdate:modelValue":l[7]||(l[7]=d=>e.personalInfo.studentId=d),placeholder:"学号",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),je,o(r,{span:24,class:"mb20",label:"电话",prop:"personalInfo.phone",rules:b.personalInfo.phone},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:e.personalInfo.phone,"onUpdate:modelValue":l[8]||(l[8]=d=>e.personalInfo.phone=d),placeholder:"电话号码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"]),ze,o(r,{span:24,class:"mb20",label:"学院",prop:"personalInfo.college",rules:b.personalInfo.college},{default:a(()=>[o(i,null,{default:a(()=>[o(_,{modelValue:e.personalInfo.college,"onUpdate:modelValue":l[9]||(l[9]=d=>e.personalInfo.college=d),placeholder:"系号+学院名称，例如“6系 计算机学院”",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["rules"])]),_:1},8,["model","rules"])]),_:1})):w("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Wt as default};
